<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Clip</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: #2f2f2f;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #ffffff;
      min-height: 100vh;
    }

    .container {
      text-align: center;
      margin-top: 20px;
      width: 100%;
      max-width: 600px;
    }

    .logo {
      max-width: 200px;
      width: auto;
      height: auto;
      margin-bottom: 20px;
      transition: transform 0.3s ease;
      cursor: pointer;
    }

    .logo:hover {
      transform: scale(1.1);
    }

    .form-group {
      margin-top: 20px;
      width: 100%;
      text-align: left;
    }

    label {
      display: block;
      font-size: 16px;
      margin-bottom: 8px;
      color: #cccccc;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #555555;
      border-radius: 6px;
      background-color: #404040;
      color: #ffffff;
      font-size: 14px;
      outline: none;
      transition: border-color 0.3s ease;
    }

    input[type="text"]:focus {
      border-color: #00c853;
    }

    .btn-generate {
      background-color: #00c853;
      color: #ffffff;
      padding: 10px 20px;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      text-transform: uppercase;
      margin-top: 10px;
      display: block;
      width: 100%;
    }

    .btn-generate:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    /* Bloc d'affichage de la réponse de l'API */
    .result-container {
      margin-top: 20px;
      padding: 15px;
      background-color: #333;
      border-radius: 6px;
      width: 100%;
      text-align: left;
      color: #ffffff;
      display: none;
    }

    .result-text {
      padding: 10px;
      background-color: #404040;
      border-radius: 6px;
      font-size: 14px;
      color: #ffffff;
      white-space: pre-line;
    }

    .loader {
      display: none;
      margin-top: 10px;
      border: 4px solid #ffffff;
      border-top: 4px solid #00c853;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html">
      <img src="assets/img/Clipomaticlogov1.png" alt="Logo Clipomatic" class="logo">
    </a>

    <!-- Champ de saisie -->
    <div class="form-group">
      <label for="userInput">Entrez vos mots ou votre phrase :</label>
      <input type="text" id="userInput" placeholder="Exemple : une histoire sur le sport, des faits historique...">
    </div>
    
    <!-- Bouton pour générer le texte -->
    <button class="btn-generate" onclick="generateClip()">Générer</button>

    <!-- Loader pendant l'attente de la réponse API -->
    <div class="loader" id="loader"></div>

    <!-- Zone d'affichage du texte généré -->
    <div class="result-container" id="result-container">
      <h3>Texte généré :</h3>
      <p class="result-text" id="result-text">...</p>
    </div>
  </div>

  <script>
    function generateClip() {
      const userInput = document.getElementById("userInput").value;

      if (!userInput) {
        alert("Veuillez entrer des mots ou une phrase.");
        return;
      }

      document.getElementById("loader").style.display = "block";
      document.getElementById("result-container").style.display = "none";

      const myHeaders = new Headers();
      myHeaders.append("Content-Type", "application/json");

      const raw = JSON.stringify({
        contents: [{
          parts: [{
            text: `Tu es un assistant créatif spécialisé dans la rédaction de textes captivants. 
            1. Écris un texte qui attire dès la première phrase pour capter l'attention sur TikTok. 
            2. Le texte doit durer au moins 60 secondes en lecture IA. 
            3. Respecte la demande de l'utilisateur : ${userInput}. 
            4. Termine par un appel à l'action subtil.` 
          }]
        }]
      });

      const requestOptions = {
        method: "POST",
        headers: myHeaders,
        body: raw,
        redirect: "follow"
      };

      fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=API_KEY", requestOptions)
        .then(response => response.json())
        .then(data => {
          console.log("Réponse API:", data); // Debugging

          document.getElementById("loader").style.display = "none";

          if (data?.candidates?.[0]?.content?.parts?.[0]?.text) {
            document.getElementById("result-text").innerText = data.candidates[0].content.parts[0].text;
            document.getElementById("result-container").style.display = "block";
          } else {
            document.getElementById("result-text").innerText = "Erreur : Réponse inattendue de l'API.";
            document.getElementById("result-container").style.display = "block";
          }
        })
        .catch(error => {
          console.error("Erreur lors de la requête :", error);
          document.getElementById("loader").style.display = "none";
          document.getElementById("result-text").innerText = "Une erreur est survenue.";
          document.getElementById("result-container").style.display = "block";
        });
    }
  </script>
</body>
</html>